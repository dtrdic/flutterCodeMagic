workflows:
  android-workflow:
    name: Android Workflow
    max_build_duration: 120
    instance_type: mac_mini_m1
    environment:
      android_signing:
        - david reference name
      groups:
        - keystore_credentials
        - firebase_credentials
      vars:
        KEYSTORE_PATH: /tmp/keystore.keystore
    scripts:
      - name: Prepare code signing
        script: echo $KEYSTORE | base64 --decode > $KEYSTORE_PATH
      - name: Set up local.properties
        script: |
          echo "flutter.sdk=$HOME/programs/flutter" > "$CM_BUILD_DIR/android/local.properties"
      - name: Get Flutter packages
        script: |
          flutter packages pub get
      - name: Build AAB with Flutter
        script: |
          flutter build appbundle --release
      - name: Build universal apk
        script: |
          android-app-bundle build-universal-apk \
            --bundle 'build/app/outputs/bundle/release/app-release.aab' \
            --ks $CM_KEYSTORE_PATH \
            --ks-pass $CM_KEYSTORE_PASSWORD \
            --ks-key-alias $CM_KEY_ALIAS \
            --key-pass $CM_KEY_PASSWORD
      - name: Build Android release
        script: |
          flutter build appbundle --release \
            --build-name=1.0.5 \
            --build-number=5
    artifacts:
      - build/**/outputs/**/*.apk
      - build/**/outputs/**/mapping.txt
      - flutter_drive.log
    publishing:
      email:
        recipients:
          - dtrdic2@gmail.com
        notify:
          success: true
          failure: false
      firebase:
        firebase_token: \nMIIEvAIBADANBgkqhkiG9w0BAQEFAASCBKYwggSiAgEAAoIBAQDIs7NesKaAyByF\nJiAkmnYGcQRcOxVb1u/pkTg9FfWCnlTWCfV50MZOQj2kskATTTf09mpggPIfx+58\nwI1mw1+EU7rKj3D1zh8aBZ72MvnBf/lHP5G5zcB6KqztwXQkzvsnLJ9VnR9MccXW\nzurbXOXSJNWN7Rd+8AVHmmDAPA/L/Z4oStJUWGkRys7khcCCcq3tD1jDxIUEPJF8\nMyeNNCMwFx1HC+rx4P4qeowMGNkt67ycBlEztCwMiQzRDvr0j3gaTLli4aXa/2p+\naKBvUG+d4un+nRGZ3LB/wxDXc2b2aB9Es/b0NqXXuCfaxfzuBRuJTRlyJko2PJxX\nb4nhp4uVAgMBAAECggEAAeAwEnf7LmPwZEwta7on1TqULFp/Ahs5pciuKl/8qepZ\n56AzM57AY7XZxqLF14hWuArfhqRd3u8q6u6Pw8CasW1o5wC9MQbqon8f87QZQnY0\nOba94WsrW9jvQc+XisqGbWDM4mt0Ae5kR3QqnL87BKJEfq2TFSQgIIGwWsuU6Daj\n1oSvSGGi5o/iG/KV9a8MVABmQX8Eflm4U6m/y9Ck+1pTP6UFQkUan/QBIdR5OXsG\nF3uAFRUg8XxCWirIyRWBbOLQpvPk0GMCev0PsFff9Yt7SkyD8T3zE2hUnsmDtYQo\n7tdKTHhybBr9A8bXyft8KsgfGMRwM2WyteufekELcQKBgQD0cDbDHkUKK5KuoV7C\nqEXF+p4MAhJKIb3J1DcefmwHEm7JsATvLQNgL6TTGgkaVWIrQinVz/I8ywF7Dvbf\nGw9epf2MGsbq5CDWyXL/iZ+gikBTB4qdOjLz2oKP4qfNtUlHZ59yPpDgaGFKvs7C\nPlsdSSd/o7jqqUVIOFim0WM8qQKBgQ
        android:
          app_id: 1:415099635189:android:ad5cbf6a24328db3b60cbc
          artifact_type: "apk"
